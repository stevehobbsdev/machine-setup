#!/usr/bin/env bash
DIR="$(cd "$(dirname "$0")" && pwd)"

# Detect OS
OS="$(uname -s)"
IS_MACOS=false
if [[ "$OS" == "Darwin" ]]; then
  IS_MACOS=true
fi

source "$DIR/environment"
source "$DIR/alias"

if [[ -d "$HOME/zed" ]]; then
  source "$HOME/zed/z.sh"
fi

# Functions
source "$DIR/functions"

# Activate mise if available
if command -v mise &> /dev/null; then
  eval "$(mise activate zsh)"
fi

# Activate starship if available
if command -v starship &> /dev/null; then
  eval "$(starship init zsh)"
fi

# Syntax highlighting - OS specific
if [[ "$IS_MACOS" == true ]]; then
  # macOS with Homebrew
  if command -v brew &> /dev/null; then
    ZSH_HIGHLIGHT_PATH="$(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
    if [[ -f "$ZSH_HIGHLIGHT_PATH" ]]; then
      source "$ZSH_HIGHLIGHT_PATH"
    fi
  fi
else
  # Linux alternatives
  if [[ -f "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]]; then
    source "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  elif [[ -f "/usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" ]]; then
    source "/usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  fi
fi

# Auto suggestions - OS specific
if [[ "$IS_MACOS" == true ]]; then
  # macOS with Homebrew
  if command -v brew &> /dev/null; then
    ZSH_AUTOSUGGESTIONS_PATH="$(brew --prefix)/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
    if [[ -f "$ZSH_AUTOSUGGESTIONS_PATH" ]]; then
      source "$ZSH_AUTOSUGGESTIONS_PATH"
    fi
  fi
else
  # Linux alternatives
  if [[ -f "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]]; then
    source "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
  elif [[ -f "/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh" ]]; then
    source "/usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
  fi
fi
